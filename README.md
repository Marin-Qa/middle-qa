# Тестирование сервиса Users Management

## Описание

Этот проект содержит тесты для сервиса управления пользователями (`UserController`). Сервис поддерживает создание, обновление, удаление, получение и фильтрацию пользователей, а также синхронизацию с внешним источником (DummyJSON).

Тесты покрывают:

- Интеграционные сценарии через REST API
- End-to-End сценарий
- Сценарии с использованием WireMock для мокирования внешних API
- Тестирование с использованием Testcontainers (Docker) для работы с реальной базой данных

Тесты написаны с использованием **JUnit 5**, **RestAssured**

---

## Типы тестов

### 1. Integration Tests (`@Tag("integration")`)
Проверяют работу API с реальной (встроенной) базой данных H2.

| Класс | Что проверяет                                                                                           |
|-------|---------------------------------------------------------------------------------------------------------|
| `CreateUserTest` | Создание пользователя                                                                                   |
| `DeleteUserTest` | Удаление пользователя                                                                                   |
| `GetFilteredUsersTest` | Фильтрация пользователей с различными параметрами (`id`, `firstName`, `lastName`, `job`, `domain`) и проверка пагинации |
| `GetUserById` | Получение пользователя по ID и проверка корректности полей                                              |
| `GetUsersTest` | Получение несколькоих пользователей из базы                                                             |
| `PutUserTest` | Изменение пользователя и проверка корректного изменения данных                                          |

---

### 2. TestContainers Tests (`@Tag("test-containers")`)
Используют **Testcontainers** для поднятия полноценной среды с базой данных.

| Класс | Что проверяет                                                                                                       |
|-------|---------------------------------------------------------------------------------------------------------------------|
| `UserManagementTestContainersTest` | Полный набор CRUD-тестов: создание, получение, изменение, удаление, фильтрация пользователей с пагинацией. |

---

### 3. WireMock Tests (`@Tag("wiremock")`)
Мокирует внешнее API DummyJSON для тестирования синхронизации пользователей.

| Класс | Что проверяет                                                                                                                   |
|-------|---------------------------------------------------------------------------------------------------------------------------------|
| `SyncUsersWireMockTest` | Проверяет синхронизацию с моком DummyJSON с разным количеством получаемых пользователей и валидирует ответ согласно мок-файлам. |

---

### 4. E2E Tests (`@Tag("e2e")`)
Полные сценарии работы сервиса от начала до конца.

| Класс | Что проверяет                                                                                                                                    |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| `UserE2ETest` | Полный пользовательский workflow(ипровизированный): синхронизация, получение, изменение, создание и удаление пользователя, проверка всех этапов. |

---

## Запуск сервиса
- Склонировать проект
- Сделать jar  
````bash
mvn clean package 
````
- Запустить сервис
````bash
cd target/ && java -jar example-0.0.1-SNAPSHOT.jar
````

## Запуск тестов
Предусловия: 
- Интеграционные тесты подразумевают, что бд уже наполнена пользователями. 
Рекомендуется после запуска приложения выполнить "/sync" с limit=100. 
````bash 
Курлом: 
curl -X 'POST' \
  'http://localhost:8081/api/users/sync?limit=100' \
  -H 'accept: */*' \
  -d ''
````
Или через swagger:
- http://localhost:8081/swagger-ui/index.html#/Users%20Management/syncUsers

### 1. Требования

- Java 17+
- Maven 3.8+
- Docker (для тестов с Testcontainers)

### 2. Запуск командой Maven

**Все тесты (кроме тех, которым нужен запущенный сервис)**
```bash
mvn clean test
```
**Интеграционные тесты с H2**
````bash
mvn verify -Dgroups=integration
````
**Тесты с Testcontainers**
````bash
mvn clean test -Dgroups=test-containers
````
**WireMock тесты**
````bash
mvn clean test -Dgroups=wiremock
````
**E2E тест**
````bash
mvn verify -Dgroups=e2e
````




